
/*#include "llt_AutoStarUT.h"*/

#include "gtest/gtest.h"
#include "llt_mockcpp.h"


using namespace testing;

#ifdef __cplusplus

extern "C" {

#endif

extern int init_om_hardware_timer();
extern int start_om_hard_timer(unsigned int value);
extern int stop_om_hard_timer();
extern unsigned int get_om_hard_timer_curtime();
extern int clear_om_hard_timer_int();

extern int start_om_hard_timer_test_uninited(unsigned int value);
extern int start_om_hard_timer_test_inited(unsigned int value);

extern int stop_om_hard_timer_test_uninited();
extern int stop_om_hard_timer_test_inited();

extern int get_om_hard_timer_curtime_test_uninited();
extern int get_om_hard_timer_curtime_test_inited();

extern int clear_om_hard_timer_int_test_uninited();
extern int clear_om_hard_timer_int_test_inited();

extern int stub_readl();
extern int readl();
extern int __raw_readl();

extern void * drv_uncache_mem_alloc( int size );
//extern int dma_alloc_coherent();
extern void *dma_alloc_coherent();
extern void *kmalloc(int , int);
extern void *__kmalloc(unsigned int size, int flags);

extern void *ioremap(unsigned long paddr, unsigned long size);
extern unsigned long hisi_lookup_va(unsigned long pa);
extern void* __arm_ioremap(unsigned long add, size_t size, unsigned int type);
extern void* __ioremap(unsigned long add, size_t size, unsigned int type);

#ifdef __cplusplus

        }

#endif
/*****************************************************************************
 被测函数  : init_om_hardware_timer
 被测功能  : om_timer_init_failed
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_init_om_hardware_timer, UT001_om_timer_init_failed)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/
    MOCKER(hisi_lookup_va).stubs().will(returnValue((unsigned long)0));
	MOCKER(__arm_ioremap).stubs().will(returnValue((void *)0));
	MOCKER(__ioremap).stubs().will(returnValue((void *)0));
    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = init_om_hardware_timer();

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(-1,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
    GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : init_om_hardware_timer
 被测功能  : om_timer_init_success
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_init_om_hardware_timer, UT002_om_timer_init_success)
{
    int ret;
	char buf[10] = {0};
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/
    MOCKER(hisi_lookup_va).stubs().will(returnValue((unsigned long)(&buf[0])));
	MOCKER(__arm_ioremap).stubs().will(returnValue((void*)(&buf[1])));
	MOCKER(__ioremap).stubs().will(returnValue((void*)(&buf[1])));

    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = init_om_hardware_timer();

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(0,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : start_om_hard_timer
 被测功能  : start_timer_failed
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_start_om_hard_timer, UT001_start_timer_failed)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/


    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = start_om_hard_timer_test_uninited(100);

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(-1,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : start_om_hard_timer
 被测功能  : start_timer_success
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月22日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_start_om_hard_timer, UT002_start_timer_success)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/


    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = start_om_hard_timer_test_inited(100);

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(0,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : stop_om_hard_timer
 被测功能  : stop_timer_failed
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_stop_om_hard_timer, UT001_stop_timer_failed)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/


    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = stop_om_hard_timer_test_uninited();

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(-1,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : stop_om_hard_timer
 被测功能  : stop_timer_success
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_stop_om_hard_timer, UT002_stop_timer_success)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/


    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = stop_om_hard_timer_test_inited();

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(0,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : get_om_hard_timer_curtime
 被测功能  : timer_uninit_failed
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_get_om_hard_timer_curtime, UT001_timer_uninit_failed)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/


    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = get_om_hard_timer_curtime_test_uninited();

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(0,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : get_om_hard_timer_curtime
 被测功能  : timer_inited_success
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/

#if 0
/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_get_om_hard_timer_curtime, UT001_timer_inited_success)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/

    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/
	MOCKER(readl).stubs().will(returnValue(100));

    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = get_om_hard_timer_curtime_test_inited();

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(100,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
    GlobalMockObject::reset();

}
#endif
/*****************************************************************************
 被测函数  : clear_om_hard_timer_int
 被测功能  : timer_uninit_failed
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_clear_om_hard_timer_int, UT001_timer_uninit_failed)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/


    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = clear_om_hard_timer_int_test_uninited();

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(-1,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : clear_om_hard_timer_int
 被测功能  : timer_init_success
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_clear_om_hard_timer_int, UT002_timer_init_success)
{
    int ret;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/


    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    ret = clear_om_hard_timer_int_test_inited();

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(0,ret);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : drv_uncache_mem_alloc
 被测功能  : size_invalid
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_drv_uncache_mem_alloc, UT001_size_invalid)
{
    void *virt_addr = NULL;
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/


    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    virt_addr = drv_uncache_mem_alloc(-1);

    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(NULL,virt_addr);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
	GlobalMockObject::reset();

}

/*****************************************************************************
 被测函数  : drv_uncache_mem_alloc
 被测功能  : size_valid
 用例条件  :

 修改历史      :
  1.日    期   : 2012年9月24日
    作    者   : 王振伟 176398
    修改内容   : 新生成UT用例

*****************************************************************************/
/*****************************************************************************
  (1)桩函数定义
*****************************************************************************/


/*****************************************************************************
  (2)UT函数实现
*****************************************************************************/
TEST(test_drv_uncache_mem_alloc, UT002_size_valid)
{
    void *virt_addr = NULL;
	char buf[10] = {0};
    /*************************************************************************
      (1)初始化测试环境
    *************************************************************************/
    MOCKER(drv_uncache_mem_alloc).stubs().will(returnValue((void*)(&buf[0])));

    /*************************************************************************
      (2)设置被测函数形参
    *************************************************************************/


    /*************************************************************************
      (3)执行被测函数
    *************************************************************************/
    virt_addr = drv_uncache_mem_alloc(100);
    /*************************************************************************
      (4)检测测试结果
    *************************************************************************/
    EXPECT_EQ(&buf[0],virt_addr);

    /*************************************************************************
      (5)清理测试环境
    *************************************************************************/
    GlobalMockObject::reset();

}

